---
layout: post
title: 科学上网之 Gost 方案v3
date: 2023-05-26 08:00:00 +0800
categories: 科学上网
tags: 科学上网 Gost Clash 安全
excerpt: 安全的自建VPN技术。
---

![Gost Cover](/images/gost.png)

# 目录

- [1. 域名购买](#1-域名购买)
- [2. VPS 购买](#2-vps-购买)
- [3. 域名托管](#3-域名托管)
- [4. 域名解析](#4-域名解析)
- [5. Gost 服务部署](#5-gost-服务部署)
  - [5.1. VPS 登录](#51-vps-登录)
  - [5.2. 端口开放](#52-端口开放)
  - [5.3. BBR 拥塞控制算法安装](#53-bbr-拥塞控制算法安装)
  - [5.4. Docker 服务安装](#54-docker-服务安装)
  - [5.5. Memos 安装](#55-memos-安装)
  - [5.6. Gost 代理服务安装](#56-gost-代理服务安装)
  - [5.7. Nginx 安装并配置](#57-nginx-安装并配置)
  - [5.8. 数字证书创建](#58-数字证书创建)
  - [5.9. 数字证书定时更新任务创建](#59-数字证书定时更新任务创建)
  - [5.10. 退出](#510-退出)
  - [5.11. Gost 代理服务验证](#511-gost-代理服务验证)
  - [5.12. Cloudflare Warp 安装](#512-cloudflare-warp-安装)
- [6. Gost 客户端使用](#6-gost-客户端使用)
  - [6.1. Mac](#61-mac)
  - [6.2 终端代理配置](#62-终端代理配置)
  - [6.3. Windows](#63-windows)
  - [6.4. Android](#64-android)
  - [6.5. iPhone、iPad](#65-iphoneipad)
  - [6.6. Other](#66-other)
- [7. 参考](#7-参考)
- [8. 扩展阅读](#8-扩展阅读)

# 前言

互联网是最强大的工具之一，我们越来越依赖它来提升自己方便自己便宜自己，不会使用互联网（不是说你会刷个抖音聊个微信就表明你会上网）则会削弱自己的竞争力，容易被社会淘汰。可是互联网在有的地区并不互联，需要我们使用魔法来打通连接，本篇教程就是魔法咒语，学会吟诵咒语则你离现代又近了一步。

自古以来东方文明的传统习惯就喜欢建墙，以为这样便可实现假想的隔绝伤害而高枕无忧，殊不知有时候带来的副作用更甚，伤敌八百自损八千，得不偿失，对应到互联网行业尤其如此。

墙墙了我们的眼见，我们以为自己的产品自己的软件已经很好了很厉害了，可简单的用了一些国外的软件后，发现它们用户体验更好，设计得更简洁好看酷炫更符合逻辑和自然交互，而且还没那么多诱导广告和金融借贷，没有那么多实名制和没必要的审核。

墙不仅墙了我们的眼界，还墙了我们的认知（当然眼界影响认知）。总以为我们是世界中心，别人都得讨好巴结我们，怕我们不和它们贸易，离了我们世界就不转了，当红杏出墙后发现并不是这样的，可能有时候还相反。墙内有很多自媒体整天在抖音微博编造瞎话、任意剪裁信息来误导普通民众（尤其只会刷抖音的村民，以此来认识世界，以为世界就是那样的），但是没有后顾之忧，因为迎合附和了墙内只有的那一种声音，反而获得某种加持挣取钵满的流量。如此种种，使得当前环境氛围变得极不正常，仇恨越来越被煽动，部分民众越来越极端偏激，民粹高企，真相、逻辑、常识被立场和意识形态淹没，我们都在宏大叙事中沾沾自喜进而忘掉了身边的灾难和人祸。我们真的愿意成为朝鲜、伊朗和俄罗斯那样的国家么，愿意那样的生活么，我们真的不怕文革再来一遍么？！

诸此种种，皆是因为只有一种声音，如果胆敢质疑这种声音，如果不是外宾，都会知道接下来会面临什么下场。墙外并非没有假消息，而是真假消息并存，可能假消息远比真消息还多，需要我们自己去分辨，但是它的特点是丰富是多样性，真相不会被人为的压制，信息源头不会被截断，这点很重要，因为你可以溯源，你直接到源头去查看信息，了解事情的原委，避免被 hack，避免消息被别有用心的二道贩子裁剪和篡改，拨云见日破除谣言直达真相。

所以突破信息茧房还是挺重要的！

此教程笔者参考了 [haoel.github.io][haoel]，步骤皆为笔者亲手实践过，适用于国内，可能有点复杂，但是相对安全，安全第一，毕竟谁也不想 “大 Boss 正在看着你”。我们翻墙后应该多看少说（为了安全），不要谈论政治和敏感话题，翻墙的目的是了解真相和学习知识、文化、技能、技术，学习英语，看剧（奈飞、迪士尼+、Apple TV+），用于提升自身水平以便更好的工作生活（挣更多的 💰）。就拿工程技术来说，尤其软件开发，应该用英文关键字在谷歌上搜索资料（中英文搜出的结果不一样，可用维基百科验证），用好 GitHub 和 stack overflow。

翻墙方式按是否收费来分有免费和付费两种，免费的一定不要作为主力来用，顶多作为被墙时的临时跳板，跳过之后就立即找寻其它更好的翻墙方式。翻墙方式按类别来分可分为机场和 VPN，VPN 可分为自建和购买，强烈建议自建，因为安全，其次会更便宜。如果嫌麻烦和复杂或其它需求而不适合自建，则推荐购买机场节点。此文为自建 VPN 教程，属于小众梯子，越小众越安全，因为被针对的可能性越小。

# 1. 域名购买

域名服务提供商：

- [GoDaddy](https://godaddy.com)
- [One](https://one.com)
- [HostDare](https://bill.hostdare.com/cart.php?a=add&domain=register)
- [GigsGigs](https://clientarea.gigsgigscloud.com/index.php?/checkdomain/register-domain)

上述前两个是经笔者验证过的部分域名服务提供商，皆可通过国内支付系统支付。其中，GoDaddy 的域名购买和使用更简单方便，One 的域名更便宜（通常最前面的推荐域名是最便宜的），但后续还得通过短信验证码激活，如果收不到短信则需要官网下载表单文件签名后邮件发过去激活。

# 2. VPS 购买

VPS 提供商：

- [搬瓦工](https://bandwagonhost.com/vps-hosting.php)
- [HostDare](https://bill.hostdare.com/store/premium-china-optimized-nvme-kvm)
- [Linode](https://www.linode.com)
- [DigitalOcean](https://www.digitalocean.com/pricing/droplets#basic-droplets)
- [AWS LightSail](https://lightsail.aws.amazon.com)
- [AWS EC2](https://aws.amazon.com/cn)
- [Google Cloud Platform](https://cloud.google.com)
- [Oracle Cloud](https://www.oracle.com/cloud/free)
- [RackNerd](https://www.racknerd.com/kvm-vps)
- [Microsoft Azure](https://azure.microsoft.com/zh-cn)

搬瓦工、HostDare、Linode、DigitalOcean、AWS LightSail/EC2、RackNerd 可支持国内支付方式支付，其它则需要国际信用卡。其中搬瓦工、HostDare 有 CN2 GIA 线路可选。更多内容请参看 [haoel.github.io-VPS](https://github.com/haoel/haoel.github.io#2-购买vps) 。

千万别用国内提供商的 VPS，容易被监控被抓。不要购买 Vultr 的 VPS，被封 IP 较多，据笔者实测，美国旧金山和洛杉矶、日本、新加坡的机器无法科学上网，只有韩国可以，而且韩国这个 IP 还被奈飞等一些网站屏蔽。

推荐购买美区的 VPS，因为各种可用资源更多限制更少，很多产品和服务都是优先在那试用使用和开服，比如谷歌的 AI 套件，比如如果购买韩国的 VPS 则油管上的一些视频的观看有年龄验证限制而美区没有。一些站点资源的观看浏览或下载不对亚区开放，访问时会被 Cloudflare 阻止而美区无限制，如：泥视频等。

# 3. 域名托管

- 注册 [Cloudflare][Cloudflare] 账号，如果没有的话。
- 添加新购买的域名。
- 将 Cloudflare 的两个名称服务器添加或替换到域名提供商的对应地方。

```txt
leif.ns.cloudflare.com

priscilla.ns.cloudflare.com
```

# 4. 域名解析

- 登录 [Cloudflare][Cloudflare]。
- 在默认网站 Tab 项的右侧点进之前托管的域名。
- 在 DNS Tab 项右侧分别添加两条 A 记录，记录名分别是 `gfw` 和 `memos`，代理状态为`仅 DNS`（即关闭代理）。

# 5. Gost 服务部署

在购买 VPS 时，安装的操作系统选最新版本的 Ubuntu。

## 5.1. VPS 登录

- 打开本地电脑终端，使用 SSH 命令登录远程服务器，格式为 `ssh [账号]@[IP]`, 如果使用的是密钥文件登录则需在账号前面指明密钥文件路径，即格式为 `ssh -i [/from/to/pass.pem] [账号]@[IP]`。
- 将 [] 部分替换为自己的内容，账号通常不是 `root` 就是 `ubuntu`。
- 如果在无错误输入的情况下还登不上，则可能需要在 VPS 服务商网站后台添加安全组项以允许 `22` 的 TCP 端口连入。有的 VPS 使用安全组来管理，则通过安全组来控制端口的开放（AWS），有的不是（Linode、Digital Ocean、Vultr），则通过乌班图的 Linux 命令 `ufw` 来开放端口，这些通常都默认开放了 22 端口以供 SSH 连接，通常不需要命令来设置。

## 5.2. 端口开放

- 开放端口以供后续其它服务使用，非安全组的 VPS 的开放命令格式为：

  ```Bash
  sudo ufw allow from any to any port [端口,...] proto tcp
  ```

- 开放 ICMP 协议以供 ping ip 使用。
- 开放 80 端口以供证书安装时使用。
- 开放 443 端口以供科学上网和访问 Memos 时使用。

## 5.3. BBR 拥塞控制算法安装

- 执行部署指令：

  ```Bash
  sudo bash -c "$(wget -qO- https://raw.githubusercontent.com/meiyingqishi/meiyingqishi.github.io/main/scripts/gost-vpn-server-on-ubuntu.sh)"
  ```

- 输入 `1` 安装 TCP BBR 拥塞控制算法。

  备注：最新版系统默认已安装了 BBR，如果被卸载了则此步骤会自动安装，如果系统内核低于要求则会自动更新内核并重启，需要重新登录并执行部署指令以进行后续操作。

## 5.4. Docker 服务安装

输入 `2` 以安装 Docker 服务程序。

## 5.5. Memos 安装

输入 `3` 以安装 Memos 服务程序。

## 5.6. Gost 代理服务安装

输入 `4` 以安装 Ghost 代理服务程序。

## 5.7. Nginx 安装并配置

- 输入 `5` 以安装 Nginx 代理服务程序。

- 输入自己前面在 Cloudflare 配置的 memos 的域名（例如：memos.zhansan.com）和 gfw 的域名（例如：gfw.zhansan.com）。

- 输入 `out` 退出。

## 5.8. 数字证书创建

- 输入 `6` 以创建数字证书。

- 输入要创建数字证书的域名，即前面在 Cloudflare 配置 memos 域名（例如：memos.zhangsan.com）和 gfw 域名（例如：gfw.zhangsan.com）。

- 输入 `out` 退出。

## 5.9. 数字证书定时更新任务创建

输入 `7` 以创建数字证书定时更新任务。

## 5.10. 退出

输入 `8` 以退出。

## 5.11. Gost 代理服务验证

```Bash
语法：
curl -v "https://www.google.com" --proxy "<host>:<port>" --proxy-user '<user>:<password>'

示例：
curl -v "https://www.google.com" --proxy "https://gfw.zhangsan.com:443" --proxy-user 'zhangsan:hgks38aTQ'
```

输出大段的控制信息和谷歌的页面代码则表示成功无误。

## 5.12. Cloudflare Warp 安装

- 大多数 VPS 的 IP 都不是原生 IP，在使用一些服务时会受到限制，比如：Netflix 没法解锁非自制内容、ChatGPT 聊天页面禁止使用、Bing 账号被挂起……，使用 Warp 可解锁原生 IP 限制。

- 执行以下指令：

  ```Bash
  wget git.io/warp.sh
  chmod +x warp.sh
  sudo ./warp.sh menu
  ```

- 分别运行脚本并分别先后输入 1，4，7 执行安装。

- 输入 ./warp.sh status 查看安装状态。正常状态如下：

  ```Bash
  WireGuard	: Running
  IPv4 Network	: WARP
  IPv6 Network	: WARP
  ```

# 6. Gost 客户端使用

## 6.1. Mac

- 下载并安装 [ClashX](https://github.com/yichengchen/clashX/releases)。

- 右键 Mac 右上角状态栏中的 ClashX 的 🐱 图标，依次选择 配置 -> 打开配置文件夹。

  ![ClashX drop down menu list](/images/ClashXDropDownMenuList.png)

- 在文件夹中创建配置文件 config.yaml。

- 拷贝粘贴以下内容到文件中:

  ```yaml
  port: 7890
  socks-port: 7891
  redir-port: 7892
  mixed-port: 7893
  ipv6: true
  allow-lan: true
  mode: Rule
  log-level: silent
  external-controller: "0.0.0.0:9090"
  secret: ""
  tun:
    enable: true
    stack: system
    dns-hijack:
      - tcp://8.8.8.8:53
      - udp://8.8.8.8:53
  dns:
    enable: true
    ipv6: true
    listen: 0.0.0.0:53
    default-nameserver:
      - 114.114.114.114
    enhanced-mode: fake-ip
    fake-ip-range: 198.18.0.1/16
    nameserver:
      - 114.114.114.114
      - 223.5.5.5
    fallback:
      - 114.114.114.114

  proxies:
    - name: "Lightsail"
      type: http
      server: gfw.zhangsan.com
      port: 443
      username: zhangsan
      password: "hgks38aTQ"
      tls: true
      skip-cert-verify: true

  proxy-groups:
    - name: "Proxy"
      type: select
      proxies:
        - Lightsail

  rules:
    - DOMAIN-SUFFIX,local,DIRECT
    - IP-CIDR,127.0.0.0/8,DIRECT
    - IP-CIDR,172.16.0.0/12,DIRECT
    - IP-CIDR,192.168.0.0/16,DIRECT
    - IP-CIDR,10.0.0.0/8,DIRECT

    - DOMAIN-SUFFIX,deepl.com,DIRECT

    - GEOIP,CN,DIRECT
    - MATCH,Proxy
  ```

- 按照前面服务器端填的内容修改 proxies 下的 server、port、username、password，自定义修改 name（proxy-groups 下的 proxies 也应同步修改）。

  - 配置参考 [clash.yaml](https://github.com/Hackl0us/SS-Rule-Snippet/blob/main/LAZY_RULES/clash.yaml) 中的注释和 [官方 wiki](https://dreamacro.github.io/clash)。

- 改完保存后，再次右击 🐱 图标，在展开的菜单中选择设置为系统代理即可。

## 6.2 终端代理配置

- 终端默认是不走代理的，有时我们需要下载的资源需要代理才能访问。

- 在终端键入 `vim ~/.zshrc` 进入 zsh 配置文件，键入 `i` 开启编辑模式，滚动到文件末尾并空一行后加入以下内容：

  ```zsh
  SOCKS="socks5://127.0.0.1:7891"
  alias proxy="export http_proxy=${SOCKS} https_proxy=${SOCKS} all_proxy=${SOCKS}"
  alias unproxy='unset all_proxy http_proxy https_proxy'
  ```

- 按键盘 ⌨️ 最左上角的 esc 键，键入 `:wq` 保存并退出文件。

- 配置完成可以使用了。在需要代理时在终端键入 `proxy` 即可开启终端代理，不需要终端代理时通过键入 `unproxy` 即可退出终端代理。

- 这一步能使用的前提是 已完成了前面 [6.1 Mac](#61-mac) 的配置并已在本地电脑上开启了 ClashX 的代理连接。

## 6.3. Windows

- 下载并安装 [Clash for Windows](https://github.com/Fndroid/clash_for_windows_pkg/releases)。

- 余后步骤类同前面 [6.1 Mac](#61-mac) 部分（由于笔者暂无 Windows 电脑，暂不方便展开后续步骤）。

## 6.4. Android

- 下载并安装 [Clash for Android](https://github.com/Kr328/ClashForAndroid/releases)。

  ![Clash4Android homepage](/images/clash4android-homepage.jpeg)

- 将在电脑上编辑好的配置文件传到手机，配置文件同前面 [6.1 Mac](#61-mac) 部分。

- 点按 Clash for Android 主界面的 Profile 按钮，然后再点按右上角的 + 号，再点按 File。

- 进入了 Profile 界面后，输入一个自定义 Name，再点击最下方的 Browse Files。

  ![Clash4AndroidProfile](/images/Clash4AndroidProfile.jpeg)

- 进入 Files 界面后，点击 Configuration.yaml 文件的右边三个竖点，选择保存的 config.yaml 文件后保存即可。

- 返回到 Profile 界面后点击右上角的保存图标保存。

- 再返回到 Profiles 界面就看到了刚配置的文件了，选中并返回主界面，Profile 那里显示出了 Xxx Activated。

- 点击主界面上灰色的「Stopped - Tap to start」后，按钮变成了蓝色的「Running」了就完成了整个过程，就可以愉快的玩耍了。

  ![Clash4AndroidRunningHomePage](/images/Clash4AndroidRunningHomePage.jpeg)

## 6.5. iPhone、iPad

- 对于 iPhone 和 iPad 可查资料想办法注册美区 Apple ID 后购买 ShadowRocket 使用。

- 由于笔者暂无相关产品，暂无法展开后续步骤，更多信息请移步 [haoel.github.io][haoel]。

## 6.6. Other

请参考 [haoel.github.io][haoel]。

# 7. 参考

- [haoel.github.io][haoel]
- [clash.yaml](https://github.com/Hackl0us/SS-Rule-Snippet/blob/main/LAZY_RULES/clash.yaml) 中的注释和 [官方 wiki](https://dreamacro.github.io/clash)

# 8. 扩展阅读

- [科学上网之 Gost 方案 v2](../20/科学上网之Gost方案v2.html)
- [科学上网之 Gost 方案](../12/科学上网之Gost方案.html)
- [科学上网之 Outline 方案](../11/科学上网之Outline方案.html)

[haoel]: https://github.com/haoel/haoel.github.io
[Cloudflare]: https://cloudflare.com
