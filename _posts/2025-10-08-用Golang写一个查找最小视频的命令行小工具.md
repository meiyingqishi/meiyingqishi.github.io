---
layout: post
title: ç”¨ Golang å†™ä¸€ä¸ªæŸ¥æ‰¾æœ€å°è§†é¢‘çš„å‘½ä»¤è¡Œå°å·¥å…·
date: 2025-10-08 20:00:00 +0800
categories: è½¯ä»¶å·¥ç¨‹
---

![Commond line tool](/assets/images/go-cli-tool.webp)

## éœ€æ±‚æè¿°

æˆ‘ç”µè„‘çš„ä¸€ä¸ªæ–‡ä»¶å¤¹é‡Œæœ‰æˆç™¾ä¸Šåƒçš„æ–‡ä»¶ï¼Œæˆ‘æƒ³æ‰¾ä¸€ä¸ªæœ€å°çš„è§†é¢‘æ–‡ä»¶ï¼ˆç”¨ [ffmpeg](https://www.ffmpeg.org) æ¥ç©ï¼Œ
å…ˆæ¯éš”å‡ ç§’æŠ½å¸§å†æŠŠæŠ½çš„å¸§åˆæˆä¸€ä¸ªè§†é¢‘ï¼‰ã€‚

## éœ€æ±‚åˆ†æ

æ­¤æ–‡æ—¨åœ¨è§£å†³å‰ä¸€ä¸ªéœ€æ±‚ï¼Œå³ï¼šåœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­æŸ¥æ‰¾ä¸€ä¸ªæœ€å°çš„è§†é¢‘æ–‡ä»¶ã€‚ç”¨ Golang å†™ä¸€ä¸ªå‘½ä»¤è¡Œå°å·¥å…·æ¥æŸ¥æ‰¾ï¼ˆæ—¨åœ¨ç»ƒæ‰‹å’Œè®°å½•ğŸ“ï¼‰ã€‚

åä¸€ä¸ªéœ€æ±‚ï¼ˆffmpeg æŠ½å¸§å†åˆæˆå¸§ï¼‰è§ç¨åçš„æ–‡æ¡£ã€‚

## å‰ææ¡ä»¶

- å¯èƒ½éœ€è¦[ç§‘å­¦ä¸Šç½‘](https://blog.thomas-yang.com/ç§‘å­¦ä¸Šç½‘/2023/05/20/ç§‘å­¦ä¸Šç½‘ä¹‹Gostæ–¹æ¡ˆv2.html)ã€‚
- Golang ç¯å¢ƒã€‚

## å·¥ç¨‹å®ç°

### 1. åˆ›å»ºé¡¹ç›®æ–‡ä»¶å¤¹

æ‰“å¼€å‘½ä»¤è¡Œæ‰§è¡Œï¼š

```zsh
mkdir -p minvideo && cd minvideo 
```

### 2. åˆå§‹åŒ–é¡¹ç›®

```zsh
go mod init minvideo
```

### 3. åˆ›å»ºä»£ç æ–‡ä»¶

```zsh
touch main.go
```

### 4. ç¼–è¾‘ä»£ç æ–‡ä»¶

> éœ€äº‹å…ˆå®‰è£…å¥½ `visual studio code` å‘½ä»¤è¡Œå·¥å…·ã€‚

```zsh
code .
```

ä»£ç ï¼š

```go
package main

import (
    "flag"
    "fmt"
    "os"
    "path/filepath"
    "strings"
)

func main() {
    // å®šä¹‰å‚æ•°
    recursive := flag.Bool("r", false, "æ˜¯å¦é€’å½’æ‰«æå­ç›®å½•")
    flag.Parse()

    if flag.NArg() < 1 {
        fmt.Println("ç”¨æ³•: findminvideo [-r] <ç›®å½•è·¯å¾„>")
        return
    }
    root := flag.Arg(0)

    videoExts := []string{".mp4", ".mov", ".mkv", ".avi", ".flv", ".wmv"}
    var minFile string
    var minSize int64 = -1

    err := filepath.WalkDir(root, func(path string, d os.DirEntry, err error) error {
        if err != nil {
            return err
        }

        // è·³è¿‡æ ¹ç›®å½•æœ¬èº«
        if path == root {
            return nil
        }

        // å¦‚æœä¸æ˜¯é€’å½’æ¨¡å¼ï¼Œé‡åˆ°ç›®å½•å°±è·³è¿‡
        if d.IsDir() && !*recursive {
            return filepath.SkipDir
        }

        // æ£€æŸ¥æ‰©å±•åæ˜¯å¦ä¸ºè§†é¢‘
        ext := strings.ToLower(filepath.Ext(d.Name()))
        if !contains(videoExts, ext) {
            return nil
        }

        info, err := d.Info()
        if err != nil {
            return nil
        }

        size := info.Size()
        if minSize == -1 || size < minSize {
            minSize = size
            minFile = path
        }

        return nil
    })

    if err != nil {
        fmt.Println("éå†ç›®å½•æ—¶å‡ºé”™:", err)
        return
    }

    if minFile == "" {
        fmt.Println("ç›®å½•ä¸­æ²¡æœ‰æ‰¾åˆ°è§†é¢‘æ–‡ä»¶")
    } else {
        fmt.Printf("æœ€å°çš„è§†é¢‘æ–‡ä»¶: %s (%.2f MB)\n", minFile, float64(minSize)/1024/1024)
    }
}

func contains(list []string, target string) bool {
    for _, v := range list {
        if v == target {
            return true
        }
    }
    return false
}
```

### 5. ç¼–è¯‘

```zsh
go build -o minvideo main.go
```

### 6. æ”¾åˆ° PATH é‡Œ

å¦‚æœä½ æƒ³åœ¨ä»»ä½•ç›®å½•ä¸‹éƒ½èƒ½è¿è¡Œï¼Œå¯ä»¥æŠŠå®ƒæ”¾åˆ° `/usr/local/bin`

```zsh
sudo mv minvideo /usr/local/bin/
```

### 7. æ¸…ç†

```zsh
cd .. && rm -rf minvideo
```

## ä½¿ç”¨ç¤ºä¾‹

- åªæ‰«æä¸€å±‚ç›®å½•

```zsh
minvideo ~/Downloads/videos
```

- é€’å½’æ‰«ææ‰€æœ‰å­ç›®å½•

```zsh
minvideo -r ~/Downloads/videos
```
